<project name="generate" default="make-all" basedir=".">
	<description>
		Compile native library.
		Dependencies:
		libavcodec libavformat libswscale
	</description>
	<property environment="env"/>
	
	<target name="make-all" depends="make-c-win,make-c-linux" />
		
	<target name="make-c-win" depends="jnigen,check-cross" if="check-cross-true">
    	<exec dir="./libpng/windows" executable="make">
    		<arg value="-f"/>
    		<arg value="cross-compile.mk"/>
    	</exec>
		<!-- TODO: devil and tiff compiling -->
	</target>	
	<target name="check-cross">
	    <condition property="check-cross-true">
	        <and>
		        <available file="/usr/bin/x86_64-w64-mingw32-gcc"/>
	        </and>
	    </condition>
	</target>
	
	<target name="make-c-linux" depends="jnigen">
		<exec dir="./devIL/linux" executable="make"/>
		<exec dir="./libpng/linux" executable="make"/>
		<exec dir="./tiff/linux" executable="make"/>
	</target>
	<target name="jnigen">
		<mkdir dir="generated"/>
		<javah class="hu.qgears.images.devil.NativeDevILConnector"
			classpath="../bin:${env.QGEARSDEPS}"
			destdir="./devIL"
			/>
		<javah class="hu.qgears.images.libpng.NativeLibPngConnector"
			classpath="../bin:${env.QGEARSDEPS}"
			destdir="./libpng"
			/>
	 	<javah class="hu.qgears.images.tiff.NativeTiffLoaderConnector"
			classpath="../bin:${env.QGEARSDEPS}"
			destdir="./tiff/jni"
			/> 
	 	<javah class="hu.qgears.images.tiff.ImageDataConnector"
			classpath="../bin:${env.QGEARSDEPS}"
			destdir="./tiff/jni"
			/>
	</target>
</project>
